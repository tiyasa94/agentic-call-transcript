import json
import re

from .crews.customer_profile_crew.customer_profile_crew import CustomerProfileCrew


def CustomerProfile():
    customer_transcripts = [
    """"2024-05-01 06:34:30: Thank you so much for your patience. Oh, I'm sorry. I'm still on. Have a good day. Yeah. Hey, I'm here. Hi. Yes. My name is Ellen. I do apologize for the wait and how may I assist you today? Hello. He's still there. Yes. Yeah. Okay? Hello. My name is Eileen. And how may I help you? I was wondering if you could send a refresh signal to my receiver. I've got you. Um I've just got to make sure that I got the right account in front of me. May I have the name on the account or the business name on the account? Dallas wind drilling Alright. I've got to get you to the correct department because I don't want to have any access to your account because it's a commercial account. So if you'll bear with me, I'll get you right over to that department. Okay? Alright. You have a great day. Let me go ahead. Good. All right. They'll be right with you momentarily. Have a great day. Bye bye.""",
    """2024-05-01 06:37:33: Thank you for choosing this business. This is walkin. And how can I help you? As I need you to send a refresh signal to my receiver. Okay? Yeah, sure. Absolutely. You have that receiver number Yeah. R. Like Robert 01 You seven. 78 88 09 Alrighty. Thank you so much. And your name. Doug Roberts. Okay, let me see. You need the smart card number. No, that's all I need. The receiver will pull it up right here. Okay dot You do have that account. Let me see here. Okay? Okay. I just sent that to hit, so just give it about 5 10 minutes, But I would just reset it on on your end. Just give it a recent anyways. Right now that we can update, but, uh, you're all set, okay? Okay? Thank you. Alright. Anything anything else? No. Alright. You have to have a great week over there. You take care. Thank you for calling this Thank you. Bye.""",
    """2024-04-15 13:58:32: Thank you so much for holding. My name is Tanya with dish business services. Now who am I speaking with today? Yep. Doug Roberts. I worked for South when drilling out of Ellen would cancel. Yes. And how can I help you today? Well, I think our old receiver is just for out. Probably time to upgrade and put a new receiver and swap it out. I'll be more than happy to help you with that. May I please get the phone number of the account number that's on the account. Uh, the main office number is five. 620 564 3800. Alright. Thank you so much. Give me just a moment. Here. Let me get that pulled up for us. I'm not on location right now, so I can't give you the ID number of it right now. Okay? We should. We should only have one, maybe two minutes running right now, anyway. Where you used to have a half a dozen things slow down and just down to two rich now. We've had these Receivers out here for a long time. I'm surprised they're still working. Brill. Perhaps. And so for security purposes can you just verify the four digit security code for me? I have no idea what it is. And Okay? This is what complicates saying. Some of the guys that ran the company or here anymore. They're still here, but they they're in the background. So to say they're impossible to get a hold of so Uh huh. Okay? I'm at I'm at your mercy here. I'm sorry. Okay, I will need to be able to verify account security. Also to get those, uh Actually, just a moment. Here you are. Oh, But yeah, so I thought I would. In order for you to get those receivers updated. Actually, you need to go ahead and contact a retailer. Do you have a retailer that you work with? No. Okay? Uh, let me get this. I have no idea the somewhere Either. Great, then cancel. 67530 ZIP code Kansas. 67601 Those are the two places towns to where I live at. Okay? So the retailer Uh, closest one. To this account would be satellite pros. And if you like, I can go ahead and give you their phone number. Bye. Where are they? Out of that? That sounds like a great window. Yeah, it is. Satellite. What did you say, bro? Pros, Hm. Okay? Yeah. Give me the number. Okay, so the phone number is gonna be 620. Yeah. 786 1705 Yeah. Okay? Okay, so if you contact them, they would be able to Take a look at doing that upgrade for you. Okay? Alright. Was there anything else I can help you with today? No, It's just trying to caught me off guard. I went Expecting now. I figured you could just mail me one. No fun. Unfortunately, not you just need to contact the retailer and and he'll help you with that upgrade. Okay. Thank you. Alright. Thank you. You have a great day. Bye bye. Yeah, you too. Bye.""",
    """2024-04-15 14:34:57: Thanks for choosing this is Carla. How can I help you today? Well, let's try to verify this account so I can get something done. I don't Uh, nobody knows that four digit pin pin number Say you're You're sending the statements to Giella, southwind drilling dot com. Okay. Do you have your account number so I can take a look at your account? Alright. I don't have it in front of me. No, I don't. What about the phone number on the account? It should be 620. 564 3800. And what is your name? Douglas Roberts. Okay? You don't know what the security code is on there. Nobody knows. We're down to two Rick managers and a gal that manages the office. Everybody else is gone. The people that originally set these accounts up or M I A I can tell you. You're sending the statements. Uh to jail at south when drilling dot com Okay? And how can I help you with this account here? We need to Purchasing a receiver. But, uh, update Get rid of the old and put in the news. Okay, so one of the receivers went bad or Four. Is it when Yeah. I'm trying to get the receiver ID number, but I don't know if I'm going to be successful at that or not. Okay? Three. Let me take a look here, Which was what type of receiver were you needing? Just a regular old Received or whatever it takes nothing fancy. 9 to 1. They just sent me here on my personal my personal account. Where is it, Wally? Alright, one second here. Okay, so to order a new remote receiver box for that, you would have to go through a local retailer. Um Well, I There wouldn't be any way to purchase one through us directly. That's kind of weird. Never had to do that before. I don't know any local. There's nobody around here that does it anymore. The number that you gave me that somebody gave me earlier in the great band area with satellite pros they don't handle. There's anymore Let me see. So I'm close to Great Bend, Kansas, or Hays, Kansas. Yeah, the only other location that I would have would be Mcphereson. Well, give me that number. Maybe they could tell me one speaking. Okay. It's called hops, Sound and electric. And their phone number is 620. 241 0077 Okay? Anybody else in the area? Maybe. Let me see. No, Nobody cares these anymore. Everybody's going to that new Okay? Yeah. I mean, if they don't sell them, you can also maybe look them up online. Um And see I know I've heard people, you know. Opportunity online. Um On eBay. Yeah, well, I don't like to do it. That's why Right? Um I like to. I like to deal with the company that provides service. Right? Um So That can help me out. Yeah. You know what I mean? Yes. Got better than mess around on me. Right? No, I understand. Um, the only other company that would this one's further this one's out of clay center. Um, they're called solar and wind systems. Their phone number is 785. 632 5029 Alright? Yes, sir.""",
    """2024-04-16 11:06:58: Thank you for choosing this. This is Jeff. May I please have your name. Yeah, bro. Hi, Debra to proceed. I just want to appreciate your loyalty. 22 years Now we look forward to having you How may I help you, Deborah? I called yesterday and the lady helped me with my account. But she Well, I guess you missed the change some of my channels. I've got getting those serious that music channels. Like 6 56 59, and I want those Alright, So Deborah, just to make sure I heard you correctly. It's used like this will not be your first time calling in regarding an issue with your account. You simply want to have access with the music channels. Sure use is that correct? And it seems like right now you're unable to access them. Is that correct? Right? That's correct, and I don't know if it's something she done or y'all done or What's happening about it? I just tried to putting it on. Oh, Like willing out from Channel 6059, and it won't let me get it. It says. I'm not prescribed to it. Bye. Okay? Okay? Don't worry, Deborah. You've reached the right person on the line. I'll be helping out. Okay. Thank you for giving us time until solving this issue. So as a first step, Debra, We will simply check if according to your channel lineup right now, if you actually subscribe to those channels, okay? Uh huh. I will get back. Alright. So there were thanks for patiently waiting. So it seems like as of the moment we speak, actually. You don't have any packages that would have you access to the Serious accident or music channels. I would be glad to make the changes right now, Deborah Okay, So how much more will it cost me? Okay, so perfect Wellness check. So, Deborah, are you have the option into, uh, purchasing? I hope programming package. To the America step 120. Been to say at the same time it drains you more channels overall. It doesn't just add Uh, serious accident channels, but rather This channels. Overall, it would Have your monthly about $30 more or Uh, you can just add on Man. As small, specific package. Specifically the serious XM channels only. Which would bring your monthly rate about $6 more. May I please know. Uh, what changes you want to make on your account today? Yeah, I just rather do the $6. I don't want it. 30 more dollars. The cause. I can't pay that much on that. I would be glad to make the changes in your account right now. Deborah, please turn the line while I check my resources and proceed. Processing it, Okay, almost done. Okay? And later on. I will just provide Uh, This closing statements about changes done on your account, okay? Okay? Okay, so Deborah Hold one second, please. Uh huh. Do what now? I'm almost done. I'm just about to make the changes. I'll get back once again. Okay? Oh, sorry about the delay there, bro. However, we're almost done. OK, Thank you for your patience. Okay? Okay? Can I ask you something else? Oh, continue. Deborah. Okay now, actually, I'm not getting ESPN either. 140. Oh, so you want to know? Uh, how you can access that channel. Right? Like the sports channels. What? Cause I usually get ESPN Espy. She didn't tell me she was taking all of them all. So if you do the package for the $30, How much would that night? My bill? Be and what I get those channels back. Oh, absolutely, Deborah, you can just have that I mean program for corporate giving package. And that will But it was also already include these music channels. Okay, determine how much would it change your monthly rate? Thanks for mentioning it. While we're not getting able to proceed with the change. One second Right? Person, Deborah, Thanks for patiently waiting. If in case we make those Taste. It will bring your monthly rate to a total of $423.11. Uh, you'll be having access with the ESPN channel 140. At the same time, the music channels. And many more. Alright, but you can't give me a cheaper package than 123. That would include that. I mean, I've been with you all like 30 years Almost I just like Okay, let's see then what we can do. Okay. Do you like this will be the next package. Uh, Aside from flex back, but let's see what we can do. There might be an Another. Add a small Adam package for your ESPN channels, okay? Okay? Cause I'm retired now 11 on Social Security and I'm a weather. And everything keeps going up and set my check. And I don't want to have to cut my cable off. But then I can't afford to keep paying. Raising these prices, either. Okay, So I just wanted to be aware of Debra so you can understand more what you're trying to do, Okay? So there are actually two types of programming packages. First would be your main package consisting of your main channels. Uh huh. The other type of package would be smaller type of package such as this one. The music channels. Or some consists of movies. Summer for kids and some of the news. So, yes, you have the, uh And I Continue. And I don't need no movies, and I don't have no kids. Actually, that's that's why you have the option into changing your corporate core package. As a whole or You just want to add some small packages. To have access to those specific areas that you have. So let us now then determine your what's your final price? If in case you want access with the ESPN channels At the same time, your music Almost done. Right? Right? Okay? If in case One second Great news, Deborah. If in case we make the change your new monthly rate would be $110.27. Would that be fine then? Okay? Are. Yeah, I can. Okay. I will not proceed with Uh, the closing statements. So Deborah, with the changes made today your new monthly rate is not $110.27 at one time charge of $26.08. Will be added to your next month's bill, making it $136.35 If you make any other changes, or have any credits or offers ending on your account, it may cost the monthly rate to change. That comes restrictions may apply. To a Professional and collegiate sports and out of market Netflix. Restrictions may apply to availability games, subject to local back out. Alright, Perfect. Deborah. I was What if What did you tell me that $26 Charges follow Oh, since Debra, you're adding these packages at the middle of the month. And Uh huh. Absolutely. It will simply be appropriately charge. As I was mentioning this that makes sense. Since we're adding it at the middle of the month. You consuming it more than the numbers of the billing cycle, so that would be it. Okay? Right? Oh, okay, so I'll let that one time thing Okay? Correct, Debra. So, yeah, it's my pleasure to help me out. Deborah in about 15 minutes, maybe More. It will reflect on your T V. Okay, If not, you can just The phone by pressing the reset. Now, Deborah. As I'm looking at your account. I just want you to be aware it seems like the equipment boxes that you're still using our old models already something that is no longer being manufactured by this network as much as possible. We already want our customers to be finally using the latest ones, especially the hopper as we call it. May I please know if you would actually want to have it changed already? Because sooner or later the old equipment starts to have technical issues. We can no longer guarantee the longevity and their consistency. Yeah. Did y'all come out and change the box because I don't know how to do it. Oh, absolutely, Deborah, But I just want you to be aware it would also make some changes with your monthly rate. Would that be fine then? No. Then don't worry about I'll deal with it now when I had the problem. It will always be available. Debra K. Maybe sooner or later you might express interest on it as filing remarking, always manage your account on our website minus dot com and undermining app. Goodbye, Deborah. I got Okay. Thank you. Bye bye.""",
    """"2024-05-01 13:00:35: Hi. Good afternoon. Thank you for choosing dish. My name is Jeff. May I have your name, please? Yeah, Jew. Suki. Don't get afternoon to you. It's my pleasure to meet you. By the way, may I have the phone number that is associated with the account that you're calling for? Please? Yeah, it's 620. 564 3800 Thank you so very much. Much. Let me just pull up an account here. Okay? Um, a Jill just to confirm. The account that I have pulled up here on my end. Do you happen to know the four digit security pin number? Excuse me. I don't um I don't know who would have set it up, is it? Uh, 2759. A moment, please. No. Do you happen to have a friend's phone number four digit number? A what? A different four digit number different four digit pin number. Aside from the one that you have provided I sure don't Let me see. Um Oh, there's action is security question here. Maybe this one. You will be able to Provide the, uh Security answer. And the security question is the first Bets, Name or your first pet's name. Bentley. And you, too. Oh, Bentley, right? Uh-huh. Are you calling in? Uh, Are you calling for your own account or for a different account just to make sure For our business account. I see that so Okay. Thank you. So much for verifying, uh, for giving me that, uh, some information. So since it's for a business. It's a It's probably a commercial account that needs to be taken care of by our commercial department. Um, would you mind staying on the line while I am actually Um, looking for the right department for you. Okay? Yep. Thank you so very much a moment, please. So I'll be transferring you right now. Thank you so much. Jill. You do take care and have the best of the They okay? Alright. You too. Thank you. Bye for now.""",
    """2024-05-01 13:04:15: Thanks for calling this business service. My name is Erica. How may I help you? Yeah, We're having one of our dishes that, um they can't seem to get it to work. Out on the rig. It's just saying that they've lost connection to the antenna. And he said, he's checked every connection and everything looks like it's in securely. So I didn't know. If there's something else What we need to do at this point. Okay? Let me take a look here for you, ma'am. Can you please provide me the account number or the phone number associated with the account? The phone number is 6205643800. 3800 Um-hum. Thank you. What's the name on the account, please? South and drilling. Thank you. What's the four digit security code on the account? I don't know what it is. I don't I didn't write it down when I set it up. Is it? Okay. Do you know the email that associated with the account? Uh-huh, Jill. J i. L l s south when drilling dot com Okay. Thank you. Would you like to update the four digit security code? Sure. Okay. What's the what? Four digit pin number. Would you like me to set up for you? Uh, let's do 1021. Okay. What's the word or phrase that would help you remember this code? Carlton. Corpsman! Mhm. And are you getting an error message on the equipment that you're getting lost connection to the antenna? See, I don't know. I wish you would have called you. But He's been difficult to deal with, Uh, the rig manager. So You know, they use these dishes out. On the the rig site in the geo campers. And All he told me was they lost connection to the antenna. Mm. That's what he keeps pulling up and like I called. I think it was Oh, it might have been Two weeks ago. Okay? And they had refreshed it or reactivated it for me. Hm? There's did you know So then you tried it and he says it's still isn't working. There's this this thing popping up saying lost connection to the antenna or no connection to the Internet. Something like that. Okay? Okay. See here. Bear with me. Okay, so I was trying to look for a message that is describing what you're telling me. It's not coming up to find anything with lost connection to it. Mhm. Right? Now, um Let me see here. Yeah, With me. Almost And it's something here. Okay, so I show that this is a institutional residential account, and it wasn't stopped by a retailer. Do you guys by any chance know who your retailer record is? You're saying like just recently, like he switched out the dish or something. I show that there was someone out there. Now. No, but I'm just trying to see like if you guys needed someone to be there. Or the best option is for someone to give us a call back from the location. To see what's going on because it shows that it's active. I don't show any issues with that. With the receiver or anything. Okay? Yeah. I do show like an authorization signal is sent out earlier. Okay? So that didn't work. You know, it would be best for someone to give us a call from the location so we can Like pretty much see what's going on and see if we can fix it for you guys over the phone. Mm. Okay. Is there maybe like a direct line that they can call for that or no? Okay? Uh, yeah. Let me give you her number. You weren't moving. Are never going to be 1 800. 454 Okay? 454, okay? 0843 0843, okay? Do they need the pin number or anything like that, or just Yeah, The pin number should be fine. I don't need the pin. Okay? Okay? Alright, I'll give them the message. Okay. Perfect. Thank you for contacting dish. Have a nice day. Bye bye. Okay. Thank you. Uh huh. You too. Bye bye.""",
    """2024-04-16 09:40:40: Thank you for holding. This is with this commercial. How can I help you? Yeah, This is Jill with south on drilling. And, um, one of our rigs. They have the receiver and their geo trailer. So I'm currently not With the receiver right now, but he's claiming it won't turn on. And my question is, Can you tell if it's activated or not? Because It's been the rig has been down for a couple of months. Mhm. And he claims it was, But I'm just curious if you can tell if On your end if it's activated if it's working Okay? Yeah. Yeah, I can definitely Locate that. And, uh, sorry for anything inconvenience You said your name is Jill. Did I hear you say that? Okay. Can I get that receiver ID? Do you have that? Yeah. Uh, the receiver number is to start with an R. It does. Would that be it? OK, B r 01. To 77. 888 09 Dash 17. He just be a minute. 880 This. It is active. Uh, but I can send an authorization out there to wake it up. I'm not Okay? Is that what it is needed, Okay. Yeah. Using that kind of situation. If it's been unused, or unplug for period of time. It just needs to be Woken up and I sent that activation out there. And, uh, Okay? Appreciate you being, uh, valued customer for Almost 20 years or anything else I can help out with. Okay? Okay? Nope. That should be it. Hi, Joe. You have a great day. Okay, you too. Thanks a lot. Alright? Uh huh. Thanks. Bye bye. Bye.""",
    """2024-04-15 14:09:47: Thank you so much for holding. My name is Tanya with dish business services. I know who am I speaking with today? This is Robert. With Southland Drilling out of Ellingwood cancel I'm stuck. And how can I help you today? I need to buy a new receiver. Alright. Well, I will be more happy to take a look here, Duck. Just on your residence. Okay? This is on the south Wind drilling account. Okay? Do you happen to have the account number for that one? No, I'm handy. No, I don't. Okay, because the only thing I pulled up was the residential account. What's, uh, Phone number on the business account. Uh, 564 3802 0564 38. That's the office number. I don't I don't know what number they use. I see Okay? But, uh, I'll give you a credit card today for a new I didn't receive it. That's all I need to do. Give me just a moment here, Doug. I gotta be able to pull the account up here. Let's see address on the account. Sure. Eight North Maine street delinquent, cancel Or That could be a box 676. You know, I can't think of the numbers. What's the zip code? Well, I'm trying to think I never use it and so on with cancers. I can Google it hang on. I think it's 6756. That ring a bell? 67 What 526 Yeah, that should be it. 67526. Okay. And so for security purposes, can you verify the four digit security code for me? I have no idea what that is. Okay? The guys that said, these accounts stuff aren't here anymore. We can't get a hold of them every year. They just stuck out of the company whenever they want a dollar so I'm screwed As far as that goes. I do have a company card here. Southwind drilling. I just wanna I'm not. I'm not able Yeah, I'm This is an institutional residential account. So I first need to get a verified normally this type. We go through, Uh, a retailer. Okay? Well, that's not gonna happen. I just called a retailer. They said. There's no reason why you guys, uh Dad Roberts. I should be authorized. I called him before several I I Yeah, I I do apologize, but you know, I have to be able to verify so Uh, we can't verify off the security code or the email address. Are you in front of the receiver? I can verify off of some of the information on the receiver box. Okay? No, I'm not there right now. I have better things to do. Besides that. Okay? I didn't picture it was gonna be this much of an L speeding. I'm just not gonna worry about it. Have we? We need to get to Yeah, we would need to get you verified first. If I can do anything on the account. You know, I've already wasted What do you need? What? Why? Why? Why? Why do you? Why do you need to get me verified Because getting ahold of these dumb houses, it's almost involved. That ain't gonna happen. No. I need the four digit security code or the email address on the account. Or we can verify off of Uh, some information if you can get somebody to get in front of one of the T V s for us. That's probably That ain't gonna happen either. That's not right now. I'm pretty much period. I'll have to call you back. Thanks. You're welcome. Bye bye."""
    ]
    
    max_attempts = 3
    customer_profile = "{}"
    feedback = "No feedback available"

    for attempt in range(max_attempts):
        print(f"\n🔄 Attempt {attempt + 1}")
        agent_output = CustomerProfileCrew().crew().kickoff(inputs={"TRANSCRIPTS": customer_transcripts, "CUSTOMER_PROFILE": customer_profile, "FEEDBACK": feedback})
        if hasattr(agent_output, "dict"):
            customer_profile_json = agent_output.dict()
        elif hasattr(agent_output, "to_dict"):
            customer_profile_json = agent_output.to_dict()
        else:
            customer_profile_json = str(agent_output)

        customer_profile_json_str = json.dumps(customer_profile_json, indent=2)

        feedback = str(json.loads(re.sub(r'```json\n|\n```', '', json.loads(customer_profile_json_str)['tasks_output'][1]['raw']).strip())['feedback'])
        customer_profile = re.sub(r'```json\n|\n```', '', json.loads(customer_profile_json_str)['tasks_output'][0]['raw']).strip()

    return customer_profile



if __name__ == "__main__":
    customer_profile = CustomerProfile()
